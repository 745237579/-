<!DOCTYPE html>
<html lang="en">
<head>
    <title>发电机并网</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
    <style>
        html, body {
            width: 100%;
            height: 100%;
        }

        body {
            background-color: #ffffff;
            margin: 0;
            overflow: hidden;
            font-family: arial;
        }

        #blocker {

            position: absolute;

            width: 100%;
            height: 100%;

            background-color: rgba(255, 255, 255,0);

        }
        #alert {
            z-index: 200;
            position: absolute;
            top: 600px;
            width: 100%;
            height: 150px;
        }

        #alert_center {
            width: 300px;
            height: 30px;
            text-align: center;
            background-color: transparent;
            display: block;
        }

        #instructions {

            width: 100%;
            height: 100%;

            display: -webkit-box;
            display: -moz-box;
            display: box;

            -webkit-box-orient: horizontal;
            -moz-box-orient: horizontal;
            box-orient: horizontal;

            -webkit-box-pack: center;
            -moz-box-pack: center;
            box-pack: center;

            -webkit-box-align: center;
            -moz-box-align: center;
            box-align: center;

            color: #ffffff;
            text-align: center;

            cursor: pointer;

        }

    </style>
</head>
<body>
<script src="js/jquery-2.0.3.min.js"></script>
<script src="js/three.js"></script>
<script src="js/PointerLockControls.js"></script>
<script src="js/DDSLoader.js"></script>
<script src="js/MTLLoader.js"></script>
<script src="js/OBJLoader.js"></script>
<script src="js/stats.min.js"></script>
<script src="js/WebGL.js"></script>
<div id="blocker">

    <div id="instructions">
        <div id="alert">
            <div id="alert_center">
                <p style="color: red" id="alert_font">
                </p>
            </div>
        </div>
    </div>

</div>
<script>
    var renderer,camera,scene,light,controls,raycaster;
    var num = 1;
    var objects = [];
    var clock = new THREE.Clock();
    var controlsEnabled = false;
    var moveForward = false;
    var moveBackward = false;
    var moveLeft = false;
    var moveRight = false;
    var canJump = false;
    var spaceUp = true;
    var raycaster1 = new THREE.Raycaster();
    var mouse1 = new THREE.Vector3();
    var horizontalRaycaster = new THREE.Raycaster(new THREE.Vector3(), new THREE.Vector3(), 0, 10);
    var downRaycaster = new THREE.Raycaster(new THREE.Vector3(), new THREE.Vector3( 0, -1, 0), 0, 10);
    var rotation = new THREE.Vector3(); //当前的相机朝向
    var speed = 1000; //控制器移动速度
    var upSpeed = 500;
    var velocity = new THREE.Vector3();
    var direction = new THREE.Vector3();
    init();
    animate();
    //绑定指针
    var zhen = new Array(13);
    for(i=0;i<13;i++) {
        zhen[i] = new Array(2);
        zhen[i][0] = "finger" + 14+i*2;
        zhen[i][1] = "finger" + 15+i*2;
    }
    function init() {

        camera = new THREE.PerspectiveCamera( 75, window.innerWidth / window.innerHeight, 1, 1000 );
        camera.position.z=0;
        camera.position.x=0;
        camera.position.y=100;
        camera.lookAt(new THREE.Vector3(-1,0,1));








        scene = new THREE.Scene();
        scene.background = new THREE.Color( 0xffffff );
        /*scene.fog = new THREE.Fog( 0xffffff, 0, 750 );*/






        var light = new THREE.HemisphereLight( 0xeeeeff, 0x777788, 0.75 );
        light.position.set( 0.5, 1, 0.75 );
        scene.add( light );








        controls = new THREE.PointerLockControls( camera );
        controls.getObject().position.y = 50;
        controls.getObject().position.x = 100;
        scene.add( controls.getObject() );
        var onKeyDown = function ( event ) {

            switch ( event.keyCode ) {

                case 38: // up

                case 87: // w

                    moveForward = true;

                    break;

                case 37: // left

                case 65: // a

                    moveLeft = true; break;

                case 40: // down

                case 83: // s

                    moveBackward = true;

                    break;

                case 39: // right

                case 68: // d

                    moveRight = true;

                    break;

                case 32: // space

                    if ( canJump && spaceUp ) velocity.y += upSpeed;

                    canJump = false;

                    spaceUp = false;

                    break;

            }

        };
        var onKeyUp = function ( event ) {

            switch( event.keyCode ) {

                case 38: // up

                case 87: // w

                    moveForward = false;

                    break;

                case 37: // left

                case 65: // a

                    moveLeft = false;

                    break;

                case 40: // down

                case 83: // s

                    moveBackward = false;

                    break;

                case 39: // right

                case 68: // d

                    moveRight = false;

                    break;

                case 32: // space

                    spaceUp = true;

                    break;

            }

        };
        document.addEventListener( 'keydown', onKeyDown, false );
        document.addEventListener( 'keyup', onKeyUp, false );



        var havePointerLock = 'pointerLockElement' in document || 'mozPointerLockElement' in document || 'webkitPointerLockElement' in document;

        if ( havePointerLock ) {

            var element = document.body;

            var pointerlockchange = function ( event ) {

                if ( document.pointerLockElement === element || document.mozPointerLockElement === element || document.webkitPointerLockElement === element ) {

                    controlsEnabled = true;

                    controls.enabled = true;

                } else {
                    controlsEnabled = false;

                    controls.enabled = false;



                }

            };


            // 监听变动事件

            document.addEventListener( 'pointerlockchange', pointerlockchange, false );

            document.addEventListener( 'mozpointerlockchange', pointerlockchange, false );

            document.addEventListener( 'webkitpointerlockchange', pointerlockchange, false );

            window.addEventListener( 'keydown', function () {

                if(window.event.keyCode == 81&&controlsEnabled==false){
                    // 锁定鼠标光标
                    element.requestPointerLock = element.requestPointerLock || element.mozRequestPointerLock || element.webkitRequestPointerLock;
                    element.requestPointerLock();
                }
            }, false );
        }


      /*  if ( controlsEnabled === true ) {

            //获取到控制器对象

            var control = controls.getObject();

            //获取刷新时间

            var delta = clock.getDelta();



            //velocity每次的速度，为了保证有过渡

            velocity.x -= velocity.x * 10.0 * delta;

            velocity.z -= velocity.z * 10.0 * delta;

            velocity.y -= 9.8 * 100.0 * delta; // 默认下降的速度



            //获取当前按键的方向并获取朝哪个方向移动

            direction.z = Number( moveForward ) - Number( moveBackward );

            direction.x = Number( moveLeft ) - Number( moveRight );

            //将法向量的值归一化

            direction.normalize();



            /!* group.position.set(control.position.x,control.position.y,control.position.z);*!/



            //判断是否接触到了模型

            rotation.copy(control.getWorldDirection().multiply(new THREE.Vector3(-1, 0, -1)));



            //判断鼠标按下的方向

            var m = new THREE.Matrix4();

            if(direction.z > 0){

                if(direction.x > 0){

                    m.makeRotationY(Math.PI/4);

                }

                else if(direction.x < 0){

                    m.makeRotationY(-Math.PI/4);

                }

                else{

                    m.makeRotationY(0);

                }

            }

            else if(direction.z < 0){

                if(direction.x > 0){

                    m.makeRotationY(Math.PI/4*3);

                }

                else if(direction.x < 0){

                    m.makeRotationY(-Math.PI/4*3);

                }

                else{

                    m.makeRotationY(Math.PI);

                }

            }

            else{

                if(direction.x > 0){

                    m.makeRotationY(Math.PI/2);

                }

                else if(direction.x < 0){

                    m.makeRotationY(-Math.PI/2);

                }

            }

            //给向量使用变换矩阵

            rotation.applyMatrix4(m);

            //horizontal.setDirection(rotation);

            horizontalRaycaster.set( control.position , rotation );



            var horizontalIntersections = horizontalRaycaster.intersectObjects( scene.children, true);

            var horOnObject = horizontalIntersections.length > 0;



            //判断移动方向修改速度方向

            if(!horOnObject){

                if ( moveForward || moveBackward ) velocity.z -= direction.z * speed * delta;

                if ( moveLeft || moveRight ) velocity.x -= direction.x * speed * delta;

            }



            //复制相机的位置

            downRaycaster.ray.origin.copy( control.position );

            //获取相机靠下10的位置

            downRaycaster.ray.origin.y -= 10;

            //判断是否停留在了立方体上面

            var intersections = downRaycaster.intersectObjects( scene.children, true);

            var onObject = intersections.length > 0;

            //判断是否停在了立方体上面

            if ( onObject === true ) {

                velocity.y = Math.max( 0, velocity.y );

                canJump = true;

            }

            //根据速度值移动控制器

            control.translateX( velocity.x * delta );

            control.translateY( velocity.y * delta );

            control.translateZ( velocity.z * delta );



            //保证控制器的y轴在10以上

            if ( control.position.y < 10 ) {

                velocity.y = 0;

                control.position.y = 10;

                canJump = true;

            }

        }*/



        window.addEventListener('click', clickTest, false);
        raycaster = new THREE.Raycaster( new THREE.Vector2(0,0,0), new THREE.Vector3( 0, -1, 0 ), 0, 10 );
       /* // floor
        var floorGeometry = new THREE.PlaneBufferGeometry( 2000, 2000, 100, 100 );
        floorGeometry.rotateX( - Math.PI / 2 );
        // vertex displacement
        var position = floorGeometry.attributes.position;

        for ( var i = 0, l = position.count; i < l; i ++ ) {

            vertex.fromBufferAttribute( position, i );

            vertex.x += Math.random() * 20 - 10;
            vertex.y += Math.random() * 2;
            vertex.z += Math.random() * 20 - 10;

            position.setXYZ( i, vertex.x, vertex.y, vertex.z );

        }

        floorGeometry = floorGeometry.toNonIndexed(); // ensure each face has unique vertices

        position = floorGeometry.attributes.position;
        var colors = [];

        for ( var i = 0, l = position.count; i < l; i ++ ) {

            color.setHSL( Math.random() * 0.3 + 0.5, 0.75, Math.random() * 0.25 + 0.75 );
            colors.push( color.r, color.g, color.b );

        }

        floorGeometry.addAttribute( 'color', new THREE.Float32BufferAttribute( colors, 3 ) );

        var floorMaterial = new THREE.MeshBasicMaterial( { vertexColors: THREE.VertexColors } );

        var floor = new THREE.Mesh( floorGeometry, floorMaterial );
        floor.position.y-=70;
        scene.add( floor )*/;

        // objects
        var onProgress = function ( xhr ) {

            if ( xhr.lengthComputable ) {

                var percentComplete = xhr.loaded / xhr.total * 100;
                console.log( Math.round( percentComplete, 2 ) + '% downloaded' );

            }

        };
        var onError = function () { };
        THREE.Loader.Handlers.add( /\.dds$/i, new THREE.DDSLoader() );
        new THREE.MTLLoader().setPath( 'model/' ).load( '2.5.mtl', function ( materials ) {
                materials.preload();
                new THREE.OBJLoader()
                    .setMaterials( materials )
                    .setPath( 'model/' )
                    .load( '2.5.obj', function ( object ) {
                        console.log(object);
                        scene.add( object );
                    }, onProgress, onError );
            } );



        renderer = new THREE.WebGLRenderer( { antialias: true } );
        renderer.setPixelRatio( window.devicePixelRatio );
        renderer.setSize( window.innerWidth, window.innerHeight );
        document.body.appendChild( renderer.domElement );
        window.addEventListener( 'resize', onWindowResize, false );
    };

    function onWindowResize() {

        camera.aspect = window.innerWidth / window.innerHeight;
        camera.updateProjectionMatrix();

        renderer.setSize( window.innerWidth, window.innerHeight );

    }
    //点击事件
    function clickTest(event) {
        event.preventDefault();
        objects = [];
        mouse1.x = ( event.clientX / window.innerWidth ) * 2 - 1;
        mouse1.y = - ( event.clientY / window.innerHeight ) * 2 + 1;
        // 通过鼠标点的位置和当前相机的矩阵计算出raycaster
        raycaster1.setFromCamera( mouse1, camera );
        this.scene.children.forEach(child => {
            //根据需求判断哪些加入objects,也可以在生成object的时候push进objects
            if (!(child instanceof THREE.GridHelper) && !(child instanceof THREE.DirectionalLight) && !(child instanceof THREE.AmbientLight)) {
                child.children.forEach(childv => {
                    if ((childv instanceof THREE.Mesh)) {//根据需求判断哪些加入objects,也可以在生成object的时候push进objects
                        this.objects.push(childv);
                        meshDg(childv.children);
                    } else if (childv instanceof THREE.Object3D) {
                        meshDg(childv.children);
                    }
                });
            }
        })
        var intersects =raycaster1.intersectObjects(this.objects);
        if (intersects.length != 0 && intersects[0].object instanceof THREE.Mesh) {
            selectObject = intersects[0].object;
            if(num==1&&selectObject.name.substring(0, 11) == 'main_switch')
            {
                $("#alert_font").html("3.设备成功开启，请点击系统开关按钮")
               changeRotation3(1);
                flash();
                light1(scene.getObjectByName("Sphere061"),-1);
                light2(scene.getObjectByName("LCbutton01"),-1);
                light2(scene.getObjectByName("XLbutton01"),-1);
                light2(scene.getObjectByName("XLbutton03"),-1);
                light2(scene.getObjectByName("XLbutton05"),-1);
                light2(scene.getObjectByName("XLbutton07"),-1);
                light2(scene.getObjectByName("XLbutton09"),-1);
                light2(scene.getObjectByName("XLbutton11"),-1);
                light2(scene.getObjectByName("XLbutton13"),-1);
                light2(scene.getObjectByName("XLbutton15"),-1);
                light2(scene.getObjectByName("YDJbutton02"),-1);
                num++;
            }
            else if(num==2&&selectObject.name=='XLbutton12')/*步骤3*/
            {
                $("#alert_font").html("4.系统开启，旋转电压切换至相电压")
                /*light(scene.getObjectByName("LCbutton01"),1);
                light(scene.getObjectByName("XLbutton01"),1);
                light(scene.getObjectByName("XLbutton03"),1);
                light(scene.getObjectByName("XLbutton05"),1);
                light(scene.getObjectByName("XLbutton07"),1);
                light(scene.getObjectByName("XLbutton09"),1);*/
                light2(scene.getObjectByName("XLbutton11"),1);
                /*light(scene.getObjectByName("XLbutton13"),1);
                light(scene.getObjectByName("XLbutton15"),1);
                light(scene.getObjectByName("YDJbutton02"),1);*/
                light1(selectObject,-1);
                changeposition1(selectObject,0);
                num++;
            }
            else if(num==3&&selectObject.name=='knob06')
            {
                $("#alert_font").html("5.旋转无穷大系统的旋钮（无穷大指针动，至相（220v）or线（380v））")
                /*changeRotation1(selectObject,45,1);*/
                document.addEventListener( 'mousedown', onMouseDown, false );
                document.addEventListener( 'mouseup', onMouseup, false );
                num++;
            }
            else if(num==4&&selectObject.name=='WQDbutton02')
            {
                $("#alert_font").html("6.关原动机开关")
                changeRoatation4("WQDfinger03","WQDfinger02",45,-1)
                num++;
            }
            else if(num==5&&selectObject.name=='YDJbutton01')/*步骤6*/
            {
                $("#alert_font").html("7.进入模拟方式")
                changeposition1(selectObject,0);
                light1(selectObject,-1);
                light2(scene.getObjectByName("YDJbutton02"),1);
                num = num + 1;
            }
            else if(num==6&&selectObject.name=='MNbutton')
            {
                $("#alert_font").html("8.调节微机调速装置模拟调节，调至额定转速")
                changeposition1(selectObject,0);
                num = num + 1;
            }
            else if(num==7&&selectObject.name=='MNknot')
            {
                $("#alert_font").html("9.旋转励磁方式为手动它励")
                show(disp_prompt());
                num++;
            }
            else if(num==8&&selectObject.name=='knob15')
            {
                $("#alert_font").html("10.按下恒UF按钮，显示灯亮（其他开关，特别是灭磁开关要松开）11.")
                changeRotation1(selectObject,45,1);
                num = num + 2;
            }
            /*else if(num==9&&selectObject.name=='')
            {
                $("#alert_font").html("11.旋转手动励磁，发电机电压指针动，转至对应的220或380v")
                changeRotation1(selectObject);
                num++;
            }*/
            else if(num==10&&selectObject.name=='LCknot02')
            {
                $("#alert_font").html("12.依次按下QF3，1，4，6，2，5或QF4,6,2,3,1,5的红灯，（红灯亮，红灯陷入，绿灯灭）")
                changeRotation1(selectObject,45,1);
                changeRotation2(scene.getObjectByName("finger20"),scene.getObjectByName("finger21"));
                num++;
            }
            else if(num==11&&selectObject.name=='XLbutton10')/*3*/
            {
                $("#alert_font").html("12.依次按下QF3，1，4，6，2，5或QF4,6,2,3,1,5的红灯，（红灯亮，红灯陷入，绿灯灭）")

                changeposition1(selectObject, 0);
                light1(selectObject, -1);
                light2(scene.getObjectByName("XLbutton09"), 1);
                num = num + 1;
            }
            else if(num == 12 && selectObject.name == 'XLbutton02')/*1*/
            {
                $("#alert_font").html("12.依次按下QF3，1，4，6，2，5或QF4,6,2,3,1,5的红灯，（红灯亮，红灯陷入，绿灯灭）")

                changeposition1(selectObject,0);
                light1(selectObject,-1);
                light2(scene.getObjectByName("XLbutton01"),1);
                num = num + 1;
            }
            else if(num == 13 && selectObject.name == 'XLbutton08')/*4*/
            {
                $("#alert_font").html("12.依次按下QF3，1，4，6，2，5或QF4,6,2,3,1,5的红灯，（红灯亮，红灯陷入，绿灯灭）")

                changeposition1(selectObject,0);
                light1(selectObject,-1);
                light2(scene.getObjectByName("XLbutton07"),1);
                num = num + 1;
            }
            else if(num == 14 && selectObject.name == 'XLbutton06')/*6*/
            {
                $("#alert_font").html("12.依次按下QF3，1，4，6，2，5或QF4,6,2,3,1,5的红灯，（红灯亮，红灯陷入，绿灯灭）")

                changeposition1(selectObject,0);
                light1(selectObject,-1);
                light2(scene.getObjectByName("XLbutton05"),1);
                num = num + 1;
            }
            else if(num == 15 && selectObject.name == 'XLbutton04')/*2*/
            {
                $("#alert_font").html("12.依次按下QF3，1，4，6，2，5或QF4,6,2,3,1,5的红灯，（红灯亮，红灯陷入，绿灯灭）")

                changeposition1(selectObject,0);
                light1(selectObject,-1);
                light2(scene.getObjectByName("XLbutton03"),1);
                num = num + 1;
            }
            else if(num == 16 && selectObject.name == 'XLbutton14')/*5*/
            {
                $("#alert_font").html("13.旋转同期方式的旋钮至手动（同期表电压频率指针水平不动，相位指针旋转）")
                changeposition1(selectObject,0);
                light1(selectObject,-1);
                light2(scene.getObjectByName("XLbutton13"),1);
                num = num + 1;
            }
            else if(num==17&&selectObject.name=='knob09')
            {
                $("#alert_font").html("14.按下发电机开关红灯，（红灯亮，红灯陷入，绿灯灭，相位指针不动）")
                changeRotation1(selectObject,45,1);
                num++;
            }
            else if(num==18&&selectObject.name=='XLbutton16')
            {
                $("#alert_font").html("15.旋转同期方式的旋钮至OFF")
                changeposition1(selectObject,0);
                light1(selectObject,-1);
                light2(scene.getObjectByName("XLbutton15"),1);
                num = num + 1;
            }
            else if(num==19&&selectObject.name=='knob09')
            {
                $("#alert_font").html("16.随机考题，具体参照流程图，调整调速器的增加量或减少量，增加或减少发电机的有功输出")
                changeRotation1(selectObject,45,-1);
                num++;
            }
            else if(num==20&&selectObject.name=='Cylinder110')
            {
                $("#alert_font").html("17.跳开励磁开关直至（发电机有功无功均为0，即旋转时指针回零）")
                changeRotation1(selectObject,45,1);
                changeRotation2(scene.getObjectByName("finger32"),scene.getObjectByName("finger33"));/*通过调速器增加减少量增减发电机有功输出*/
                num++;
            }
            else if(num==21&&selectObject.name=='LCbutton02')
            {
                $("#alert_font").html("18.逆旋转微机调速装置中的模拟调节，发动机停下来")
                changeposition1(selectObject,0);
                light1(selectObject,-1);
                light2(scene.getObjectByName("LCbutton01"),1);
                changeRotation2(scene.getObjectByName("finger32"),scene.getObjectByName("finger33"));
                changeRotation2(scene.getObjectByName("finger34"),scene.getObjectByName("finger35"));/*有用无功均为0，指针归零*/
                num++;
            }
            else if(num==22&&selectObject.name=='MNknot')
            {
                $("#alert_font").html("19.按下原动机开关绿灯，绿亮，红起，红灭")
                changeRotation1(selectObject,45,1);
                num++;
            }
            else if(num==23&&selectObject.name=='YDJbutton02')
            {
                $("#alert_font").html("20.依次按下QF5，1,3,2,6,4或QF5,6,4，1,3,2的红灯，绿亮，红起，红灭")
                changeposition1(scene.getObjectByName("YDJbutton01"),1);/*原动机开关关开关凸起*/
                light1(scene.getObjectByName("YDJbutton01"),1);/*原动机开关关开关暗下*/
                light2(selectObject,0);/*原动机开关开开关亮起*/
                num = num + 1;
            }
            else if(num==24&&selectObject.name=='XLbutton13')/*5*/
            {
                $("#alert_font").html("20.依次按下QF5，1,3,2,6,4或QF5,6,4，1,3,2的红灯，绿亮，红起，红灭")
                changeposition1(scene.getObjectByName("XLbutton14"),1);/*qf5关开关凸起*/
                light1(scene.getObjectByName("XLbutton14"),1);/*qf5关开关暗下*/
                light2(selectObject,0);/*qf5开开关亮起*/
                num = num + 1;
            }
            else if(num==25&&selectObject.name=='XLbutton01')/*1*/
            {
                $("#alert_font").html("20.依次按下QF5，1,3,2,6,4或QF5,6,4，1,3,2的红灯，绿亮，红起，红灭")
                changeposition1(scene.getObjectByName("XLbutton02"),1);/*qf1关开关凸起*/
                light1(scene.getObjectByName("XLbutton02"),1);/*qf1关开关暗下*/
                light2(selectObject,0);/*qf1开开关亮起*/
                num = num + 1;
            }
            else if(num==26&&selectObject.name=='XLbutton09')/*3*/
            {
                $("#alert_font").html("20.依次按下QF5，1,3,2,6,4或QF5,6,4，1,3,2的红灯，绿亮，红起，红灭")
                changeposition1(scene.getObjectByName("XLbutton10"),1);/*qf3关开关凸起*/
                light1(scene.getObjectByName("XLbutton10"),1);/*qf3关开关暗下*/
                light2(selectObject,0);/*qf3开开关亮起*/
                num = num + 1;
            }
            else if(num==27&&selectObject.name=='XLbutton03')/*2*/
            {
                $("#alert_font").html("20.依次按下QF5，1,3,2,6,4或QF5,6,4，1,3,2的红灯，绿亮，红起，红灭")
                changeposition1(scene.getObjectByName("XLbutton04"),1);/*qf2关开关凸起*/
                light1(scene.getObjectByName("XLbutton04"),1);/*qf2关开关暗下*/
                light2(selectObject,0);/*qf2开开关亮起*/
                num = num + 1;
            }
            else if(num==28&&selectObject.name=='XLbutton05')/*6*/
            {
                $("#alert_font").html("20.依次按下QF5，1,3,2,6,4或QF5,6,4，1,3,2的红灯，绿亮，红起，红灭")
                changeposition1(scene.getObjectByName("XLbutton06"),1);/*qf6关开关凸起*/
                light1(scene.getObjectByName("XLbutton06"),1);/*qf6关开关暗下*/
                light2(selectObject,0);/*qf6开开关亮起*/
                num = num + 1;
            }
            else if(num==29&&selectObject.name=='XLbutton07')/*4*/
            {
                $("#alert_font").html("21.按系统开关绿灯，绿亮，红起，红灭")
                changeposition1(scene.getObjectByName("XLbutton08"),1);/*qf4关开关凸起*/
                light1(scene.getObjectByName("XLbutton08"),1);/*qf4关开关暗下*/
                light2(selectObject,0);/*qf4开开关亮起*/
                num = num + 1;
            }
            else if(num==30&&selectObject.name=='XLbutton11')
            {
                $("#alert_font").html("22.断开电源开关各个开关灯灭，微机自检灯暗")
                changeposition1(scene.getObjectByName("XLbutton12"),1);/*系统开关关开关凸起*/
                light1(scene.getObjectByName("XLbutton12"),1);/*系统开关关开关暗下*/
                light2(selectObject,0);/*系统开关开开关亮起*/
                num = num + 1;
            }
            else if(num==31&&selectObject.name=='main_switch01')
            {
                $("#alert_font").html("23.旋转无穷大系统的旋钮（无穷大指针归零")
                changeRotation1(selectObject,45,1);
                light2(scene.getObjectByName("LCbutton01"),1);
                light2(scene.getObjectByName("XLbutton01"),1);
                light2(scene.getObjectByName("XLbutton03"),1);
                light2(scene.getObjectByName("XLbutton05"),1);
                light2(scene.getObjectByName("XLbutton07"),1);
                light2(scene.getObjectByName("XLbutton09"),1);
                light2(scene.getObjectByName("XLbutton11"),1);
                light2(scene.getObjectByName("XLbutton13"),1);
                light2(scene.getObjectByName("XLbutton15"),1);
                light2(scene.getObjectByName("YDJbutton02"),1);/*各个开关灯灭*/
                num++;
            }
            else if(num==32&&selectObject.name=='WQDbutton02')
            {
                $("#alert_font").html("好像结束了")
                changeRotation1(selectObject,45,1);
                changeRotation2(scene.getObjectByName("WQDfinger03"),scene.getObjectByName("WQDfinger02"));/*通过调速器增加减少量增减发电机有功输出*/
                num++;
            }





            /*$("#alert_font").html("当前点击的模块名字是：" + selectObject.name/!*+'A'+
            selectObject.geometry.boundingBox.min.x+'A '+
                ((selectObject.geometry.boundingBox.max.y + selectObject.geometry.boundingBox.min.y) / 2)+'A '
            +(selectObject.geometry.boundingBox.max.z + selectObject.geometry.boundingBox.min.z/ 2))*!/)*/
        }

    }

    //led的绑定、
    var LED = new Array(6);
    for (var i=0;i<6;i++)
    {
        LED[i]=new Array(8);
    }
    LED[0]=['LED48','LED16','LED06','LED21','LED24','LED32','LED07','LED08'];
    LED[1]=['LED10','LED14','LED15','LED13','LED12','LED11','LED05','LED09'];
    LED[2]=['LED18','LED22','LED23','LED40','LED20','LED19','LED03','LED17'];
    LED[3]=['LED26','LED30','LED31','LED29','LED28','LED27','LED02','LED25'];
    LED[4]=['LED34','LED38','LED39','LED37','LED36','LED35','LED04','LED33'];
    LED[5]=['LED42','LED46','LED47','LED45','LED44','LED43','LED01','LED41'];

    //绿灯按钮的亮暗控制
    function light2(object,i) {
            var material1 = new THREE.MeshLambertMaterial({
                material: 0.5,
                transparent: true,
                color:0x99ff00
            });
            var material2 = new THREE.MeshLambertMaterial({
                material: 0.5,
                transparent: true,
                color:0x058605
            });
            if (i==-1)
                object.material = material1;
            else
                object.material = material2;
    }

    //灯闪烁
    var flag=1;
    function flash() {
        flag= -1 *flag;
        light2(scene.getObjectByName('Sphere052'),flag);
        setTimeout( 'flash()',800);
    }

    //红灯按钮的亮暗控制
    function light1(object,i) {
        var material1 = new THREE.MeshLambertMaterial({
            material: 0.5,
            transparent: true,
            color:0xff3300
        });
        var material2 = new THREE.MeshLambertMaterial({
            material: 0.5,
            transparent: true,
            color: 0x860505
        });
        if (i==-1)
            object.material=material1;
        else
            object.material=material2;
        object.geometry.groupsNeedUpdate = true;
    }

    //按钮的凹陷
    function changeposition1(object,i) {
        if(i==0)
            object.position.x+=2;
        else
            object.position.x-=2;
    }

    //旋转开关旋转
    function changeRotation1(object,angle,flag) {
        object.geometry.computeBoundingBox();
        var point = new THREE.Object3D();
        point.position.set((object.geometry.boundingBox.max.x + object.geometry.boundingBox.min.x) / 2,
            (object.geometry.boundingBox.max.y + object.geometry.boundingBox.min.y) / 2,
            (object.geometry.boundingBox.max.z + object.geometry.boundingBox.min.z) / 2);
        scene.add(point);
        point.add(object);
        object.position.set(-(object.geometry.boundingBox.max.x + object.geometry.boundingBox.min.x) / 2,
            -(object.geometry.boundingBox.max.y + object.geometry.boundingBox.min.y) / 2,
            -(object.geometry.boundingBox.max.z + object.geometry.boundingBox.min.z) / 2);
        if(flag!=1)
            point.rotation.x+=(Math.PI/180)*angle;
        var i =0;
        function render() {
            if(i<angle){
                requestAnimationFrame(render);
                if(flag==1){
                    point.rotation.x+=Math.PI/180;
                }
                else
                    point.rotation.x-=Math.PI/180;
            }
            i++;

        }
        render();
        point.update = true;
    }

    //上下波动指针
    function changeRotation2(object,object2) {
        object.geometry.computeBoundingBox();
        var point = new THREE.Object3D();
        point.position.set((object.geometry.boundingBox.max.x+object.geometry.boundingBox.min.x)/2,
            object.geometry.boundingBox.min.y,
            object.geometry.boundingBox.max.z );
        scene.add(point);
        point.add(object);
        point.add(object2);
        object.position.set(-(object.geometry.boundingBox.max.x+object.geometry.boundingBox.min.x)/2,
            - object.geometry.boundingBox.min.y,
            - object.geometry.boundingBox.max.z );
        object2.position.set(-(object.geometry.boundingBox.max.x+object.geometry.boundingBox.min.x)/2,
            - object.geometry.boundingBox.min.y,
            - object.geometry.boundingBox.max.z );

        var i=1;
        function render(){
            //循环调用render（）
            requestAnimationFrame(render);
            if(i%64<32)
                point.rotation.x+=Math.PI/180;
            else
                point.rotation.x-=Math.PI/180;
            i++;
            if(i==64){i=0;}
        }
        render();
    }

    //拉闸开关的旋转
    /*function f(object) {
        let flag=1;
        let i=0;
        function render() {
            if (i < 90) {
                requestAnimationFrame(render);
                if(flag==1)
                    object.rotation.z-=Math.PI/180;
                else
                    object.rotation.z+=Math.PI/180;
                i++;
            }
            renderer.render(scene,camera);
        }
        render();
    }*/
    function changeRotation3(flag) {
        let center = scene.getObjectByName("Cylinder097");
        center.geometry.computeBoundingBox();
        let point = new THREE.Object3D();
        point.position.set(center.geometry.boundingBox.max.x,
            (center.geometry.boundingBox.min.y+center.geometry.boundingBox.max.y)/2,
            (center.geometry.boundingBox.max.z+center.geometry.boundingBox.min.z)/2 );
        let b = scene.getObjectByName("main_switch02");
        let a = scene.getObjectByName("main_switch01");
        a.position.set(-center.geometry.boundingBox.max.x,
            -(center.geometry.boundingBox.min.y+center.geometry.boundingBox.max.y)/2,
            -(center.geometry.boundingBox.max.z+center.geometry.boundingBox.min.z)/2 );
        b.position.set(-center.geometry.boundingBox.max.x,
            -(center.geometry.boundingBox.min.y+center.geometry.boundingBox.max.y)/2,
            -(center.geometry.boundingBox.max.z+center.geometry.boundingBox.min.z)/2 );
        scene.add(point);
        point.add(b);
        point.add(a);
        let i = 0;
        if(flag!=1)
            point.rotation.z-=Math.PI/2;
        function render() {
            if (i < 90) {
                requestAnimationFrame(render);
                if(flag==1)
                    point.rotation.z-=Math.PI/180;
                else
                    point.rotation.z+=Math.PI/180;
                i++;
            }
            renderer.render(scene,camera);
        }
        render();
    }

    //指针的旋转指定角度
    function changeRoatation4(name1,name2,angle,flag) {
        var object1=scene.getObjectByName(name1);
        var object2=scene.getObjectByName(name2);
        object1.geometry.computeBoundingBox();
        var point = new THREE.Object3D();
        point.position.set((object1.geometry.boundingBox.max.x + object1.geometry.boundingBox.min.x) / 2,
            object1.geometry.boundingBox.min.y,
            object1.geometry.boundingBox.max.z);
        object1.position.set(-(object1.geometry.boundingBox.max.x + object1.geometry.boundingBox.min.x) / 2,
            -object1.geometry.boundingBox.min.y,
            -object1.geometry.boundingBox.max.z);
        object2.position.set(-(object1.geometry.boundingBox.max.x + object1.geometry.boundingBox.min.x) / 2,
            -object1.geometry.boundingBox.min.y,
            -object1.geometry.boundingBox.max.z);
        point.add(object2);
        point.add(object1);
        scene.add(point);
        var i = 0;
        function render() {
            //循环调用render（）
            requestAnimationFrame(render);
            if (i < angle) {
                if (flag == -1)
                    point.rotation.x += (Math.PI / 180);
                else
                    point.rotation.x -= (Math.PI / 180);
                i++;
                renderer.render(scene, camera);
            }
        }
        render();
    }

    //Z轴为轴心
    function changeRotation5(object){
        object.geometry.computeBoundingBox();
        var temp = new THREE.Object3D();
        temp.position.set((object.geometry.boundingBox.max.x + object.geometry.boundingBox.min.x) / 2,
            (object.geometry.boundingBox.max.y + object.geometry.boundingBox.min.y) / 2,
            (object.geometry.boundingBox.max.z + object.geometry.boundingBox.min.z) / 2);
        scene.add(temp);
        temp.add(object);
        object.position.set(-(object.geometry.boundingBox.max.x + object.geometry.boundingBox.min.x) / 2,
            -(object.geometry.boundingBox.max.y + object.geometry.boundingBox.min.y) / 2,
            -(object.geometry.boundingBox.max.z + object.geometry.boundingBox.min.z) / 2);
        var i = 0;
        function render() {
            if (i < 90) {
                requestAnimationFrame(render);
                temp.rotation.y +=Math.PI/180;
                i++;
            }
        }
        render();
    }

    //LED的显示
    function number(num,position,flag) {

        switch (num) {
            case '0':
                for(let i =0;i<6;i++)
                    light(scene.getObjectByName(position[i]));
                break;
            case '1':
                light(scene.getObjectByName(position[1]));
                light(scene.getObjectByName(position[2]));
                break;
            case '2':
                light(scene.getObjectByName(position[0]));
                light(scene.getObjectByName(position[1]));
                light(scene.getObjectByName(position[3]));
                light(scene.getObjectByName(position[4]));
                light(scene.getObjectByName(position[6]));
                break;
            case '3':
                light(scene.getObjectByName(position[0]));
                light(scene.getObjectByName(position[1]));
                light(scene.getObjectByName(position[3]));
                light(scene.getObjectByName(position[2]));
                light(scene.getObjectByName(position[6]));break;
            case '4':
                light(scene.getObjectByName(position[5]));
                light(scene.getObjectByName(position[6]));
                light(scene.getObjectByName(position[1]));
                light(scene.getObjectByName(position[2]));break;
            case '5':
                light(scene.getObjectByName(position[0]));
                light(scene.getObjectByName(position[5]));
                light(scene.getObjectByName(position[2]));
                light(scene.getObjectByName(position[3]));
                light(scene.getObjectByName(position[6]));break;
            case '6':
                light(scene.getObjectByName(position[0]));
                light(scene.getObjectByName(position[5]));
                light(scene.getObjectByName(position[4]));
                light(scene.getObjectByName(position[3]));
                light(scene.getObjectByName(position[2]));
                light(scene.getObjectByName(position[6]));break;
            case '7':
                light(scene.getObjectByName(position[0]));
                light(scene.getObjectByName(position[1]));
                light(scene.getObjectByName(position[2]));break;
            case '8':
                for(var i=0;i<7;i++)
                    light(scene.getObjectByName(position[i]));break;
            case '9':
                light(scene.getObjectByName(position[0]));
                light(scene.getObjectByName(position[1]));
                light(scene.getObjectByName(position[2]));
                light(scene.getObjectByName(position[3]));
                light(scene.getObjectByName(position[5]));
                light(scene.getObjectByName(position[6]));break;
        }
        if(flag==1){
            light(scene.getObjectByName(position[7]));
        }
        function light(object) {
            let material3 = new THREE.MeshLambertMaterial({
                color:0xff3300,
            })
            object.material=material3;
        }
    }

    //调用这个函数
    function show(num) {
        let k=num.length;
        for (let i = num.length; i >0; i--,k--) {
            if (num.substring(i-1,i)== '.') {
                number(num.substring(i - 2, i - 1), LED[5 - (num.length - k)], 1);
                i--;
            }
            else
                number(num.substring(i-1,i), LED[5-(num.length-k)], -1);
        }
    }

    //输入框,返回输入
    function disp_prompt() {

        var name = prompt("请输入角度");
        return name;

    }

    //鼠标拖拽
    function onMouseDown(event){
        event.preventDefault();
        mouseDown = true;
        mouseX = event.clientX;//出发事件时的鼠标指针的水平坐标

        rotateStart.set( event.clientX, event.clientY );
        document.addEventListener( 'mousemove', onMouseMove2, false );
    }

    function onMouseup(event){
        mouseDown = false;

        document.removeEventListener("mousemove", onMouseMove2);
    }

    function onMouseMove2(event,object){
        if(!mouseDown){
            return;
        }
        var deltaX = event.clientX - mouseX;
        mouseX = event.clientX;
        rotateScene(deltaX,objects);
    }

    //设置模型旋转速度，可以根据自己的需要调整
    function rotateScene(deltaX,object){
        //设置旋转方向和移动方向相反，所以加了个负号
        object.geometry.computeBoundingBox();
        var point = new THREE.Object3D();
        point.position.set((object.geometry.boundingBox.max.x + object.geometry.boundingBox.min.x) / 2,
            (object.geometry.boundingBox.max.y + object.geometry.boundingBox.min.y) / 2,
            (object.geometry.boundingBox.max.z + object.geometry.boundingBox.min.z) / 2);
        scene.add(point);
        point.add(object);
        object.position.set(-(object.geometry.boundingBox.max.x + object.geometry.boundingBox.min.x) / 2,
            -(object.geometry.boundingBox.max.y + object.geometry.boundingBox.min.y) / 2,
            -(object.geometry.boundingBox.max.z + object.geometry.boundingBox.min.z) / 2);
        var deg = -deltaX/279;
        //deg 设置模型旋转的弧度
        point.rotation.x+= deg;
    }



    function meshDg(child) {
        child.forEach(childv => {
            if(childv instanceof THREE.Mesh) { //根据需求判断哪些加入objects,也可以在生成object的时候push进objects
                this.objects.push(childv)
            } else if(childv instanceof THREE.Object3D) {
                meshDg(childv.children);
            }
        });
    }

    function animate() {

        requestAnimationFrame(animate);

          if ( controlsEnabled === true ) {

             //获取到控制器对象

             var control = controls.getObject();

             //获取刷新时间

             var delta = clock.getDelta();



             //velocity每次的速度，为了保证有过渡

             velocity.x -= velocity.x * 10.0 * delta;

             velocity.z -= velocity.z * 10.0 * delta;

             velocity.y -= 9.8 * 100.0 * delta; // 默认下降的速度



             //获取当前按键的方向并获取朝哪个方向移动

             direction.z = Number( moveForward ) - Number( moveBackward );

             direction.x = Number( moveLeft ) - Number( moveRight );

             //将法向量的值归一化

             direction.normalize();



             /!* group.position.set(control.position.x,control.position.y,control.position.z);*!/



             //判断是否接触到了模型

             rotation.copy(control.getWorldDirection().multiply(new THREE.Vector3(-1, 0, -1)));



             //判断鼠标按下的方向

             var m = new THREE.Matrix4();

             if(direction.z > 0){

                 if(direction.x > 0){

                     m.makeRotationY(Math.PI/4);

                 }

                 else if(direction.x < 0){

                     m.makeRotationY(-Math.PI/4);

                 }

                 else{

                     m.makeRotationY(0);

                 }

             }

             else if(direction.z < 0){

                 if(direction.x > 0){

                     m.makeRotationY(Math.PI/4*3);

                 }

                 else if(direction.x < 0){

                     m.makeRotationY(-Math.PI/4*3);

                 }

                 else{

                     m.makeRotationY(Math.PI);

                 }

             }

             else{

                 if(direction.x > 0){

                     m.makeRotationY(Math.PI/2);

                 }

                 else if(direction.x < 0){

                     m.makeRotationY(-Math.PI/2);

                 }

             }

             //给向量使用变换矩阵

             rotation.applyMatrix4(m);

             //horizontal.setDirection(rotation);

             horizontalRaycaster.set( control.position , rotation );



             var horizontalIntersections = horizontalRaycaster.intersectObjects( scene.children, true);

             var horOnObject = horizontalIntersections.length > 0;



             //判断移动方向修改速度方向

             if(!horOnObject){

                 if ( moveForward || moveBackward ) velocity.z -= direction.z * speed * delta;

                 if ( moveLeft || moveRight ) velocity.x -= direction.x * speed * delta;

             }



             //复制相机的位置

             downRaycaster.ray.origin.copy( control.position );

             //获取相机靠下10的位置

             downRaycaster.ray.origin.y -= 10;

             //判断是否停留在了立方体上面

             var intersections = downRaycaster.intersectObjects( scene.children, true);

             var onObject = intersections.length > 0;

             //判断是否停在了立方体上面

             if ( onObject === true ) {

                 velocity.y = Math.max( 0, velocity.y );

                 canJump = true;

             }

             //根据速度值移动控制器

             control.translateX( velocity.x * delta );

             control.translateY( velocity.y * delta );

             control.translateZ( velocity.z * delta );



             //保证控制器的y轴在10以上

             if ( control.position.y < 10 ) {

                 velocity.y = 0;

                 control.position.y = 10;

                 canJump = true;

             }

         }

        renderer.render(scene, camera);

    }


</script>
</body>
</html>
